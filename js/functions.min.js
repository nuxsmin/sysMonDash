(function(a){a.fn.highlight=function(c){var d={delay:1000};var b=a.extend(d,c);return this.each(function(){var e=a(this);a(e).css("color",b.fgcolor_on);a(e).css("background-color",b.bgcolor_on)})}}(jQuery));function SMD(){jQuery.noConflict();var c;var a;var b=this;var f=0;var g=false;this.SMDConfig=function(){var l=10000,i=0,h="/ajax/getData.php",m="",k=false;var j=[];this.setTimeout=function(n){l=n*1000};this.getTimeout=function(){return l};this.setScroll=function(n){i=n};this.getScroll=function(){return i};this.setAjaxFile=function(n){h=n};this.getAjaxFile=function(){if(m===""){return b.getRootPath()+h}return h};this.setLang=function(n){j.push(n)};this.getLang=function(n){return j[n]};this.setRemoteServer=function(n){m=n};this.getRemoteServer=function(){return m};this.setAudioEnabled=function(n){k=n};this.getAudioEnabled=function(){return k}};this.getRootPath=function(){var i=window.location.pathname.split("/");var h=function(){var j="";for(var k=1;k<=i.length-2;k++){j+="/"+i[k]}return j};return window.location.protocol+"//"+window.location.host+h()};this.hex2rgb=function(l){var k=parseInt(l.substring(1),16);var j=(k&16711680)>>16;var i=(k&65280)>>8;var h=k&255;return"rgb("+j+", "+i+", "+h+")"};this.updateNagiosData=function(){var i=jQuery("#monitor-data");this.setTime();var h=a.getRemoteServer()+a.getAjaxFile();jQuery.ajax({url:h,cache:false,timeout:a.getTimeout(),dataType:"html",success:function(k){i.html(k);if(a.getScroll()){c=jQuery(document).height();if(c>window.innerHeight){setTimeout(function(){b.pageScroll()},a.getTimeout()/2)}}var j=jQuery(".new");if(f<j.length){f=j.length;d()}j.highlight({bgcolor_on:b.hex2rgb("#ffff00"),fgcolor_on:b.hex2rgb("#333333")})},error:function(k,l,j){i.html('<div id="nomessages" class="error">'+a.getLang(1)+"<p>"+k.status+" "+k.statusText+"</p></div>")}})};this.updateCountDown=function(){var i=jQuery("#refreshing_countdown");var h=parseInt(i.text());if(h==0){b.updateNagiosData();i.text(a.getTimeout())}else{i.text(h-1)}};this.setTime=function(){var k=new Date();var h=("0"+k.getDate()).slice(-2)+"-"+("0"+(k.getMonth()+1)).slice(-2)+"-"+k.getFullYear();var l=("0"+k.getHours()).slice(-2);var i=("0"+k.getMinutes()).slice(-2);var j=("0"+k.getSeconds()).slice(-2);jQuery("#hora").find("h1").html(h+"<br>"+l+":"+i+":"+j)};this.pageScroll=function(){jQuery("body,html").animate({scrollTop:c},a.getTimeout()/2,function(){b.pageUnScroll()}).on("mousemove",function(){jQuery(this).stop(true)})};this.pageUnScroll=function(){jQuery("body,html").scrollTop(0)};this.reloadPage=function(){window.location.reload(false)};this.saveConfig=function(h){jQuery.ajax({url:b.getRootPath()+"/ajax/saveConfig.php",type:"post",dataType:"json",data:h.serialize(),success:function(i){var j=jQuery("#result");j.removeClass();if(i.status==0){j.addClass("ok")}else{j.addClass("error")}j.html(i.description)}})};this.getNewLivestatusBackend=function(){var i=jQuery(".backendLivestatus").length;var h=jQuery(".livestatusTemplate").clone();h.find("[name='backend[livestatus][alias]']")[0].name="backend[livestatus]["+i+"][alias]]";h.find("[name='backend[livestatus][path]']")[0].name="backend[livestatus]["+i+"][path]]";h.find("[name='backend[livestatus][active]']")[0].name="backend[livestatus]["+i+"][active]]";return h.html()};this.getNewStatusBackend=function(){var i=jQuery(".backendStatus").length;var h=jQuery(".statusTemplate").clone();h.find("[name='backend[status][alias]']")[0].name="backend[status]["+i+"][alias]]";h.find("[name='backend[status][path]']")[0].name="backend[status]["+i+"][path]]";h.find("[name='backend[status][active]']")[0].name="backend[status]["+i+"][active]]";return h.html()};this.getNewZabbixBackend=function(){var i=jQuery(".backendZabbix").length;var h=jQuery(".zabbixTemplate").clone();h.find("[name='backend[zabbix][alias]']")[0].name="backend[zabbix]["+i+"][alias]";h.find("[name='backend[zabbix][url]']")[0].name="backend[zabbix]["+i+"][url]";h.find("[name='backend[zabbix][version]']")[0].name="backend[zabbix]["+i+"][version]";h.find("[name='backend[zabbix][user]']")[0].name="backend[zabbix]["+i+"][user]";h.find("[name='backend[zabbix][pass]']")[0].name="backend[zabbix]["+i+"][pass]";h.find("[name='backend[zabbix][active]']")[0].name="backend[zabbix]["+i+"][active]";return h.html()};this.getNewSMDBackend=function(){var i=jQuery(".backendSMD").length;var h=jQuery(".SMDTemplate").clone();h.find("[name='backend[smd][alias]']")[0].name="backend[smd]["+i+"][alias]";h.find("[name='backend[smd][url]']")[0].name="backend[smd]["+i+"][url]";h.find("[name='backend[smd][token]']")[0].name="backend[smd]["+i+"][token]";h.find("[name='backend[smd][active]']")[0].name="backend[smd]["+i+"][active]";return h.html()};this.getUpdates=function(){jQuery("#updates").load(this.getRootPath()+"/ajax/getUpdates.php")};this.startSMD=function(){jQuery.ajaxSetup({global:false,timeout:a.getTimeout()/2});this.updateNagiosData();setInterval(function(){b.updateNagiosData()},a.getTimeout())};this.setConfig=function(h){a=h};this.makeHash=function(k){var l="";var j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var h=0;h<k;h++){l+=j.charAt(Math.floor(Math.random()*j.length))}return l};this.setConfigHooks=function(){var h=jQuery("#frmConfig");h.on("submit",function(i){i.preventDefault();b.saveConfig(h)}).find("select").each(function(){var j=jQuery(this);var i=j.data("selected");j.val(i)});jQuery("#addLivestatusBackend").on("click",function(j){j.preventDefault();var i=jQuery("<div/>",{"class":"backendLivestatus backendConfig",html:b.getNewLivestatusBackend()}).hide().appendTo("#backends-config-container").slideDown("slow");var k=i.offset();window.scroll(0,k.top)});jQuery("#addStatusBackend").on("click",function(j){j.preventDefault();var i=jQuery("<div/>",{"class":"backendStatus backendConfig",html:b.getNewStatusBackend()}).hide().appendTo("#backends-config-container").slideDown("slow");var k=i.offset();window.scroll(0,k.top)});jQuery("#addZabbixBackend").on("click",function(j){j.preventDefault();var i=jQuery("<div/>",{"class":"backendZabbix backendConfig",html:b.getNewZabbixBackend()}).hide().appendTo("#backends-config-container").slideDown("slow");var k=i.offset();window.scroll(0,k.top)});jQuery("#addSMDBackend").on("click",function(j){j.preventDefault();var i=jQuery("<div/>",{"class":"backendSMD backendConfig",html:b.getNewSMDBackend()}).hide().appendTo("#backends-config-container").slideDown("slow");var k=i.offset();window.scroll(0,k.top)});jQuery("#backends-config-container").on("click",".backendDelete",function(k){k.preventDefault();var i=window.confirm(a.getLang(0));if(i===true){var j=jQuery(this).parent().parent(".backendConfig");j.slideUp("slow",function(){j.remove()})}}).on("click",".backendCheckSMD",function(n){n.preventDefault();var m=jQuery(this).parent().parent(".backendConfig");var k=m.find(".backend_smd_url").val();var l=m.find(".backend_smd_token").val();if(k===""){alertify.alert(a.getLang(4));return}var j={url:k,action:10,token:l};var i={action:"smdBackend",data:JSON.stringify(j)};e(i)}).on("click",".backendCheckZabbix",function(p){p.preventDefault();var n=jQuery(this).parent().parent(".backendConfig");var j=n.find(".backend_zabbix_version").val();var m=n.find(".backend_zabbix_url").val();var l=n.find(".backend_zabbix_user").val();var o=n.find(".backend_zabbix_pass").val();if(j===""||m===""){alertify.alert(a.getLang(4));return}var k={url:m,version:j,user:l,pass:o};var i={action:"zabbixBackend",data:JSON.stringify(k)};e(i)});jQuery(".btn-gen-token, .btn-gen-pass").click(function(j){var i=b.makeHash(32);document.getElementById(this.getAttribute("data-dst")).value=i;jQuery(this).next(".fa-eye").attr("title",i)});jQuery(".fa-eye").click(function(){var i=this.getAttribute("title");if(i!==""){alertify.alert(i)}});jQuery("#special_config_pass").on("keyup",function(){jQuery(this).parent().find(".fa-eye").attr("title",this.value)});jQuery("#btnBack").click(function(){location.href=b.getRootPath()});jQuery(".container-state").on("click",function(k){var i=document.getElementById(this.getAttribute("data-container"));var j=i.getAttribute("aria-expanded");if(j=="true"){i.setAttribute("aria-expanded","false");jQuery(this).removeClass("fa-caret-up").addClass("fa-caret-down");jQuery(i).slideUp("slow")}else{i.setAttribute("aria-expanded","true");jQuery(this).removeClass("fa-caret-down").addClass("fa-caret-up");jQuery(i).slideDown("slow")}})};this.setDashboardHooks=function(){};var d=function d(){if(a.getAudioEnabled()){var h=document.getElementById("audio-alarm");var i=a.getTimeout()/1000;if(h.duration>=i&&g===false){h.addEventListener("timeupdate",function(){g=true;if(h.currentTime>=i-2){h.pause();h.currentTime=0}})}h.play()}};var e=function(h){jQuery.ajax({url:b.getRootPath()+"/ajax/checkConfig.php",type:"post",dataType:"json",data:h,success:function(i){var j;if(typeof i.status==="undefined"||i.status!==0){j=a.getLang(3)+"<br>"+a.getLang(2)+" "+i.description||"";alertify.alert(j)}else{j=a.getLang(1)+"<br>"+a.getLang(2)+" "+i.description;alertify.alert(j)}}})}}var smd=new SMD();var config=new smd.SMDConfig();